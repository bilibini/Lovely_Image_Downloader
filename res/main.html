<html>
<head>
    <meta charset="UTF-8">
    <title>图片下载器</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div id="bg"></div>
    <div class="bgop"></div>
    <div style="display: none;" id="custom-menu" onmousedown="aardio.hitCaption();return false;" >
        <div class="menu-text"><span>美图下载器</span></div>
        <div class="menu-div">
            <Button type="text" >▁</Button>
            <Button type="text" id="closed-btn" >✘</Button>
        </div>
    </div>
    <div style="top:0;" id="main">
        <div class="row">
            <!-- <div class="box" oncontextmenu="downImg('http://img4.cache.netease.com/photo/0031/2017-01-17/CB0520AV6LRF0031.jpg')" onclick="lookImg('http://img4.cache.netease.com/photo/0031/2017-01-17/CB0520AV6LRF0031.jpg')">
                <img src="http://img4.cache.netease.com/photo/0031/2017-01-17/CB0520AV6LRF0031.jpg" alt="">
            </div> -->
        </div>
    </div>
    <script type="text/javascript">
        function lookImg(imgsrc){
            aardio.look(imgsrc);
            aardio.lookEND();
        }
        function downImg(imgsrc){
            aardio.down(imgsrc);
        }
        function addImg(imgsrc,simgsrc,title){
            var main=document.querySelector("#main .row");
            var box=`<div class="box" oncontextmenu="downImg('${imgsrc}')" onclick="lookImg('${imgsrc}')"><img src="${simgsrc}" onerror="this.src='/bg.png'" loading="lazy" alt="${title}"></div>`;
            main.insertAdjacentHTML("beforeend",box);
        }
        async function getImglist(iN){
            let imgsrclists=await aardio.getImg(iN)
            let imgjsonlist=JSON.parse(imgsrclists)
            for(let imgjson of imgjsonlist){
                addImg(imgjson['url'],imgjson['smallurl'],imgjson['title']);
            }
        }
        var iNumber=1;
		// getImglist(iNumber);
        // 原生JS 判断整个文档滚动至底部
        window.onscroll = ()=>{
            // 窗口高度
            var windowHeight = document.body.clientHeight;
            // 页面高度
            var documentHeight = document.body.scrollHeight;
            // 滚动条位置
            var scrollTop =  document.body.scrollTop;
            if ((windowHeight + scrollTop + 2) >= documentHeight) {
                //页面滚动到达底部
                iNumber=iNumber+1;
                getImglist(iNumber);
            }
        }

    </script>
</body>
</html>